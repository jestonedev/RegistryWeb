@model RegistryDb.Models.Entities.KumiAccounts.KumiPayment;


<table class="table table-bordered table-striped m-0">
    <thead>
        <tr>
            <th class="text-center p-1" rowspan="2">Назначение (ЛС/ИР)</th>
            <th class="text-center p-1" colspan="2">Сумма распределена</th>
        </tr>
        <tr>
            <th class="text-center p-1" >На найм</th>
            <th class="text-center p-1" >На пени</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var charge in Model.PaymentCharges.GroupBy(r => new { r.Charge.IdAccount, r.Charge.Account.Account }))
        {
            <tr>
                <td class="text-center p-1">
                    ЛС @charge.Key.Account
                    <a class="btn oi oi-eye p-0 text-primary rr-payment-assoc-eye-btn" target="_blank"
                       asp-action="Details" asp-controller="KumiAccounts"
                       asp-route-returnUrl="@($"{Context.Request.Scheme}://{Context.Request.Host}{Context.Request.Path}{Context.Request.QueryString}")"
                       asp-route-idAccount="@charge.Key.IdAccount"></a>
                </td>
                <td class="text-center p-1">@charge.Select(r => r.TenancyValue).Sum()</td>
                <td class="text-center p-1">@charge.Select(r => r.PenaltyValue).Sum()</td>
            </tr>
        }
        @foreach (var claim in Model.PaymentClaims.GroupBy(r => new { r.Claim.IdClaim, r.Claim.StartDeptPeriod, r.Claim.EndDeptPeriod, r.Claim.IdAccountKumiNavigation.Account }))
        {
            <tr>
                <td class="text-center p-1">
                    ИР №@claim.Key.IdClaim
                    @{ 
                        var claimPeriod = (claim.Key.StartDeptPeriod != null || claim.Key.EndDeptPeriod != null ? "(" : "");
                        claimPeriod += (claim.Key.StartDeptPeriod != null ? "с " + @claim.Key.StartDeptPeriod.Value.ToString("dd.MM.yyyy") : "");
                        claimPeriod += (claim.Key.StartDeptPeriod != null && claim.Key.EndDeptPeriod != null ? " " : "");
                        claimPeriod += (claim.Key.EndDeptPeriod != null ? "по " + @claim.Key.EndDeptPeriod.Value.ToString("dd.MM.yyyy") : "");
                        claimPeriod += (claim.Key.StartDeptPeriod != null || claim.Key.EndDeptPeriod != null ? ")" : "");
                    }
                    @claimPeriod
                    <a class="btn oi oi-eye p-0 text-primary rr-payment-assoc-eye-btn" target="_blank"
                       asp-action="Details" asp-controller="Claims"
                       asp-route-returnUrl="@($"{Context.Request.Scheme}://{Context.Request.Host}{Context.Request.Path}{Context.Request.QueryString}")"
                       asp-route-idClaim="@claim.Key.IdClaim"></a>
                </td>
                <td class="text-center p-1">@claim.Select(r => r.TenancyValue).Sum()</td>
                <td class="text-center p-1">@claim.Select(r => r.PenaltyValue).Sum()</td>
            </tr>
        }
    </tbody>
</table>